                                                                 # ELK Stack с FastAPI приложением

Этот проект представляет собой полноценное решение для централизованного сбора логов с использованием ELK-стека (Elasticsearch, Logstash, Kibana) и демонстрационного FastAPI приложения, которое отображает мировую статистику в реальном времени.

## Структура проекта

```
elk-fastapi-project/
├── docker-compose.yml    # Основной файл для запуска всех сервисов
├── .env                  # Файл с переменными окружения
├── setup.sh              # Скрипт для создания конфигурационных файлов
├── elasticsearch/        # Конфигурация Elasticsearch
├── logstash/             # Конфигурация Logstash
├── kibana/               # Конфигурация Kibana
├── filebeat/             # Конфигурация Filebeat
└── app/                  # FastAPI приложение
    ├── Dockerfile
    ├── requirements.txt
    ├── main.py
    ├── static/
    │   ├── css/
    │   └── js/
    └── templates/
```

## Быстрый старт

### Предварительные требования

- Docker
- Docker Compose

### Установка и запуск

1. Клонируйте репозиторий:

```bash
git clone <ссылка-на-репозиторий>
cd elk-fastapi-project
```

2. Создайте необходимые конфигурационные файлы с помощью скрипта:

```bash
chmod +x setup.sh
./setup.sh
```

3. Запустите все сервисы:

```bash
docker-compose up --build -d
```

4. Дождитесь запуска всех сервисов (это может занять несколько минут).

## Компоненты

### Elasticsearch

Elasticsearch используется для хранения и индексирования логов. Доступен по адресу: http://localhost:9200

Учетные данные по умолчанию:
- Пользователь: elastic
- Пароль: changeme (можно изменить в файле .env)

### Kibana

Kibana предоставляет интерфейс для визуализации логов. Доступна по адресу: http://localhost:5601

Учетные данные те же, что и для Elasticsearch.

### Logstash

Logstash обрабатывает логи, полученные от Filebeat, выполняет их парсинг и отправляет в Elasticsearch.

### Filebeat

Filebeat собирает логи из указанных файлов и отправляет их в Elasticsearch.

### FastAPI приложение

Демонстрационное веб-приложение, которое отображает мировую статистику и пишет логи. Доступно по адресу: http://localhost:8000

## Настройка Kibana для просмотра логов

1. Откройте Kibana в браузере: http://localhost:5601
2. Войдите с учетными данными:
   - Имя пользователя: elastic
   - Пароль: changeme (или тот, который указан в файле .env)
3. Перейдите в раздел "Management" -> "Stack Management" -> "Index Patterns" 
4. Нажмите "Create index pattern"
5. Введите `app-logs-*` в поле "Index pattern name"
6. Выберите `@timestamp` в качестве временного поля
7. Нажмите "Create index pattern"
8. Перейдите в раздел "Discover" для просмотра логов

## Особенности приложения

FastAPI приложение отображает следующие данные:
- Мировое население и демографическая статистика
- Статистика COVID-19
- Продукты питания и потребление воды
- Экологические данные
- Технологические данные
- Текущее время и дата

Все данные генерируются и обновляются каждые 30 секунд для симуляции изменений в режиме реального времени.

## Логирование

Приложение записывает логи в файл `/app/logs/app.log`. Эти логи собираются с помощью Filebeat и отправляются в ELK-стек для централизованного хранения и анализа.

## Как проверить работу

1. Откройте приложение в браузере: http://localhost:8000
2. Выполните несколько действий (например, обновите страницу несколько раз)
3. Откройте Kibana: http://localhost:5601
4. Перейдите в раздел "Discover" и проверьте, что логи появились

## Выключение сервисов

Чтобы остановить все сервисы, выполните:

```bash
docker-compose down
```

Чтобы остановить сервисы и удалить все данные (включая тома):

```bash
docker-compose down -v
```